<!DOCTYPE html><html><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>[EPUB][Ruby]『APIデザインケーススタディ』を、ソースコードのシンタックスハイライトしながら読む | アペフチ</title><script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script><link href="../../components/elements.vulcanized.html" rel=import /><link rel=alternate type="application/atom+xml" title="アペフチ" href="../../recent-days.atom"/><link href="../../bower_components/sanitize-css/sanitize.css" rel=stylesheet /><link href="../../stylesheets/highlight-81ca03d6.css" rel=stylesheet /><script src="../../javascripts/all-d7c52391.js"></script><link href="../../favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="../../images/favicon-8d71db77.png" rel=icon type="image/png" size=60x60 /><link href="/apehuci/manifest.json" rel=manifest><meta name=theme-color content="#b71c1c"><meta name=og:title content="[EPUB][Ruby]『APIデザインケーススタディ』を、ソースコードのシンタックスハイライトしながら読む『APIデザインケーススタディ』を、ソースコードのシンタックスハイライトしながら読む"><meta name=twitter:description content="昨日（EPUB書籍に正誤表を反映する（Rubyスクリプトで）、またはEPUBのパッチプログラムの試み）に引き続き「ちゃんと正誤表を公表してくれる著者と、DRMをかけない素のEPUBファイルを配信してくれる出版社があればこそ」シリーズの第二弾（第三弾は多分無い）。 以前Dockerエキスパート養成読本を、ソースコードのシンタックスハイライトしながら読むという日記..."><meta name=twitter:card content=summary><meta name=twitter:site content=@KitaitiMakoto><meta name=twitter:image content="https://kitaitimakoto.github.io/apehuci/images/icon-bbe8ac52.png"></head><body class="x2016 x2016_01 x2016_01_03"><blog-router base-regex="^/apehuci/"></blog-router><main><app-header-layout><app-header fixed shadow slot=header><app-toolbar><h2 class=site-title><a href="../../"> アペフチ <paper-ripple></paper-ripple></a></h2></app-toolbar></app-header><article><header><paper-card><h1>『APIデザインケーススタディ』を、ソースコードのシンタックスハイライトしながら読む</h1><time pubdate>2016-01-03</time><ul class=tags><li><a href="../../tags/epub.html" rel=tag>EPUB</a></li><li><a href="../../tags/ruby.html" rel=tag>Ruby</a></li></ul></paper-card></header><paper-card><p>昨日（<a href="02.html">EPUB書籍に正誤表を反映する（Rubyスクリプトで）、またはEPUBのパッチプログラムの試み</a>）に引き続き「ちゃんと正誤表を公表してくれる著者と、DRMをかけない素のEPUBファイルを配信してくれる出版社があればこそ」シリーズの第二弾（第三弾は多分無い）。</p><p>以前<a href="http://apehuci-kitaitimakoto.sqale.jp/apehuci/?date=20150705">Dockerエキスパート養成読本を、ソースコードのシンタックスハイライトしながら読む</a>という日記を書いたが、その時のスクリプトを修正して、『APIデザインケーススタディ』にも対応させた。</p><div class=booklog_html><table><tr><td class=booklog_html_image><a href="http://www.amazon.co.jp/API%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%B1%E3%83%BC%E3%82%B9%E3%82%B9%E3%82%BF%E3%83%87%E3%82%A3-%7ERuby%E3%81%AE%E5%AE%9F%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E3%80%82%E5%95%8F%E9%A1%8C%E3%81%AB%E5%8D%B3%E3%81%97%E3%81%9F%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%81%A8%E6%99%AE%E9%81%8D%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9-WEB-PRESS-plus/dp/4774178020%3FSubscriptionId%3D0AVSM5SVKRWTFMG7ZR82%26tag%3Dbooklog.jp-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4774178020" target=_blank><img src="http://ecx.images-amazon.com/images/I/514Ve4nSUZL._SL160_.jpg" width=105 height=150 style="border:0;border-radius:0;"/></a></td><td class=booklog_html_info style="padding-left:20px;"><div class=booklog_html_title style="margin-bottom:10px;font-size:14px;font-weight:bold;"><a href="http://www.amazon.co.jp/API%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%B1%E3%83%BC%E3%82%B9%E3%82%B9%E3%82%BF%E3%83%87%E3%82%A3-%7ERuby%E3%81%AE%E5%AE%9F%E4%BE%8B%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E3%80%82%E5%95%8F%E9%A1%8C%E3%81%AB%E5%8D%B3%E3%81%97%E3%81%9F%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%81%A8%E6%99%AE%E9%81%8D%E3%81%AE%E8%80%83%E3%81%88%E6%96%B9-WEB-PRESS-plus/dp/4774178020%3FSubscriptionId%3D0AVSM5SVKRWTFMG7ZR82%26tag%3Dbooklog.jp-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4774178020" target=_blank>APIデザインケーススタディ ~Rubyの実例から学ぶ。問題に即したデザインと普遍の考え方 (WEB+DB PRESS plus)</a></div><div style="margin-bottom:10px;"><div class=booklog_html_author style="margin-bottom:15px;font-size:12px;;line-height:1.2em">著者 : <a href="http://booklog.jp/author/%E7%94%B0%E4%B8%AD%E5%93%B2" target=_blank>田中哲</a></div><div class=booklog_html_manufacturer style="margin-bottom:5px;font-size:12px;;line-height:1.2em">技術評論社</div><div class=booklog_html_release style="font-size:12px;;line-height:1.2em">発売日 : 2015-12-16</div></div><div class=booklog_html_link_amazon><a href="http://booklog.jp/item/1/4774178020" style="font-size:12px;" target=_blank>ブクログでレビューを見る»</a></div></td></tr></table></div><p>元々の本は（PDF版から類推するに）ソースコードの所も白黒のようだけど、こうしてハイライトして読むことができるようになる。</p><figure><a href="https://gyazo.com/ed5d038aace704a0fcea8313dddf3fb9" target=gyazo><img src="//gyazo.com/ed5d038aace704a0fcea8313dddf3fb9.png" alt="Rubyのコードがシンタックスハイライトされている" style="max-width: 50%;"/></a><a href="https://gyazo.com/5bf04bb00b3537f488e4811ceab3f826" target=gyazo><img src="//gyazo.com/5bf04bb00b3537f488e4811ceab3f826.png" alt="PythonやPerlも含めソースコードがシンタックスハイライトされている" style="max-width: 50%;"/></a></figure><p>スクリプトは前と同じ所に置いてある：<br/><a href="https://gist.github.com/KitaitiMakoto/0779a34fd74bae96468f">https://gist.github.com/KitaitiMakoto/0779a34fd74bae96468f</a></p><p>クローンなりダウンロードなりして</p><div class=highlighter-rouge><pre class=highlight><code>$ ruby rougify-gdp-book.rb path/to/api-design.epub
</code></pre></div><p>と実行すればよい。</p><p>これで、ようやく本を読む準備が整った。</p><blockquote><p>ともあれ、<strong>こんなことができるのも、ちゃんと正誤表を公表してくれる著者と、DRMをかけない素のEPUBファイルを配信してくれる出版社があればこそ</strong>。感謝したい。</p></blockquote><p>（<a href="http://sho.tdiary.net/20151222.html"><cite>EPUB書籍に正誤表を反映する</cite></a>）</p><p>である。</p><hr/><p>スクリプトの修正にあたって、プログラミング言語の推測に苦労した（ハイライトに使っている<a href="http://rouge.jneen.net/">Rouge</a>はshebangを見るくらいしかしてくれない）。主な方法は、「そのソースコードが含まれる節の見出し（<code class=highlighter-rouge>h2</code>や<code class=highlighter-rouge>h3</code>）と言語の対応表を作る」ということになった。「見出しにシステムコールという語が含まれていればCだろう」という具合である。</p><p>これも中々うまい法則を見付けられず、結局一つ一つの見出しと<code class=highlighter-rouge>code</code>要素を見て手作業で対応表を作った。途中、「こんなのは人間の仕事ではない！」と思って<a href="https://github.com/github/linguist">github-linguist</a>の使用も検討したが、Gitリポジトリー全体でなく個別のテキストに対して使う方法がすぐに分からなかったのでやめた。</p><p>技評の方で<code class=highlighter-rouge>&lt;code&gt;</code>要素の<code class=highlighter-rouge>class</code>属性や<code class=highlighter-rouge>data-*</code>属性で言語名を書いておいてくれると、一番楽なんだけどなあ。</p><hr/><p>ところで、確認中に、EPUB版の索引が全然機能しないことに気付いたんだけど、これも本文へのリンクにするスクリプトを配ったら喜ばれるものだろうか……。</p></paper-card><footer><ul><li class=next><a href="15.html" rel=next><paper-button raised>Groongaの運用（データの守り方）</paper-button></a></li><li class=prev><a href="02.html" rel=prev><paper-button raised>EPUB書籍に正誤表を反映する（Rubyスクリプトで）、またはEPUBのパッチプログラムの試み</paper-button></a></li></ul><paper-card><blog-search url="https://search.apehuci.kitaitimakoto.net/d" base=/apehuci/ table=Apehuci debounce-duration=300></blog-search></paper-card><paper-card> &copy; <a class=copy href="https://twitter.com/KitaitiMakoto">北市真</a></paper-card></footer></article></app-header-layout></main><script defer async src="//hypothes.is/embed.js"></script><script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script></body></html>