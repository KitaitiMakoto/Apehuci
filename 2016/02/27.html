<!DOCTYPE html><html><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>[http/2][Groonga]日記の検索部分をHTTP/2対応した | アペフチ</title><script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script><link href="../../components/elements.vulcanized.html" rel=import /><link rel=alternate type="application/atom+xml" title="アペフチ" href="../../recent-days.atom"/><link href="../../bower_components/sanitize-css/sanitize.css" rel=stylesheet /><link href="../../stylesheets/highlight-81ca03d6.css" rel=stylesheet /><script src="../../javascripts/all-d7c52391.js"></script><link href="../../favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="../../images/favicon-8d71db77.png" rel=icon type="image/png" size=60x60 /><link href="/apehuci/manifest.json" rel=manifest><meta name=theme-color content="#b71c1c"><meta name=og:title content="[http/2][Groonga]日記の検索部分をHTTP/2対応した日記の検索部分をHTTP/2対応した"><meta name=twitter:description content="この日記の検索機能（フッターの検索フォームからできる）ではgroonga-httpdを使っている。日記本文はGitHub Pagesにホストしてもらっている。GitHub PagesはHTTPでもHTTPSでもどちらでもアクセスできて、ツイッターなどでURIを貼る時には僕はHTTPSの方を使っている。だがgroonga-httpdはこれまでHTTPSに対応して..."><meta name=twitter:card content=summary><meta name=twitter:site content=@KitaitiMakoto><meta name=twitter:image content="https://kitaitimakoto.github.io/apehuci/images/icon-bbe8ac52.png"></head><body class="x2016 x2016_02 x2016_02_27"><blog-router base-regex="^/apehuci/"></blog-router><main><app-header-layout><app-header fixed shadow slot=header><app-toolbar><h2 class=site-title><a href="../../"> アペフチ <paper-ripple></paper-ripple></a></h2></app-toolbar></app-header><article><header><paper-card><h1>日記の検索部分をHTTP/2対応した</h1><time pubdate>2016-02-27</time><ul class=tags><li><a href="../../tags/http-2.html" rel=tag>http/2</a></li><li><a href="../../tags/groonga.html" rel=tag>Groonga</a></li></ul></paper-card></header><paper-card><p>この日記の検索機能（フッターの検索フォームからできる）では<a href="http://groonga.org/ja/docs/reference/executables/groonga-httpd.html">groonga-httpd</a>を使っている。日記本文は<a href="https://pages.github.com/">GitHub Pages</a>にホストしてもらっている。GitHub PagesはHTTPでもHTTPSでもどちらでもアクセスできて、ツイッターなどでURIを貼る時には僕はHTTPSの方を使っている。だがgroonga-httpdはこれまでHTTPSに対応していなかったので、<a href="https://developer.mozilla.org/ja/docs/Web/API/XMLHttpRequest">XHR</a>で接続することができなかった。仕方なく前段に<a href="http://nginx.org/">Nginx</a>を立てて、そこでTLSの終端をしていた。</p><p>日課の<code class=highlighter-rouge>apt-get update &amp;&amp; apt-get upgrade</code>をしていたらGroongaの各種パッケージが降って来たので更新内容を確認しに行った（<a href="http://groonga.org/ja/docs/news.html#release-6-0-0">6.0.0リリース - 2016-02-29</a>）。そこにTLSサポートのことが書かれていたので、早速この日記の検索サーバーでもアップデートして、TLSを有効にした（と書くと白々しいか、TLSサポートは僕が要望した物だった：<a href="https://osdn.jp/projects/groonga/lists/archive/dev/2016-February/003951.html">https://osdn.jp/projects/groonga/lists/archive/dev/2016-February/003951.html</a>）。</p><p>また、groonga-httpdは前々からHTTP/2が使えるようになっていたので、ついでにそちらも有効にした。</p><p>検索は単純にキーアップイベントを拾い、入力の一文字目からその都度groonga-httpdに検索リクエストを投げるようにしているので、HTTP/2でコネクションを張りっぱなしにして検索できるのは効果が大きいのではないかと思う（測ってない）。</p><p>ただ、検索用に日記のデータを入力するのは手元のスクリプトで<a href="https://github.com/ranguba/groonga-client">groonga-client</a> gemを使って実行していたのだが、このgemがHTTPS対応していないのでそこを対応しないといけない。それまでは、今日のこの日記以降の記事は検索対象にならない。HTTP接続用の別のポートを開けてもいいが、まあいいだろう。</p></paper-card><footer><ul><li class=next><a href="29.html" rel=next><paper-button raised>Sendagaya.rb #139</paper-button></a></li><li class=prev><a href="26.html" rel=prev><paper-button raised>Groongaでできる検索方法あれこれ</paper-button></a></li></ul><paper-card><blog-search url="https://search.apehuci.kitaitimakoto.net/d" base=/apehuci/ table=Apehuci debounce-duration=300></blog-search></paper-card><paper-card> &copy; <a class=copy href="https://twitter.com/KitaitiMakoto">北市真</a></paper-card></footer></article></app-header-layout></main><script defer async src="//hypothes.is/embed.js"></script><script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script></body></html>