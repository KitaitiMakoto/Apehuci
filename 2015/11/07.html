<!DOCTYPE html><html><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>[Middleman][kramdown][Rouge]Middleman v4でシンタックスハイライト | アペフチ</title><script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script><link href="../../components/elements.vulcanized.html" rel=import /><link rel=alternate type="application/atom+xml" title="アペフチ" href="../../recent-days.atom"/><link href="../../bower_components/sanitize-css/sanitize.css" rel=stylesheet /><link href="../../stylesheets/highlight-81ca03d6.css" rel=stylesheet /><script src="../../javascripts/all-d7c52391.js"></script><link href="../../favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="../../images/favicon-8d71db77.png" rel=icon type="image/png" size=60x60 /><link href="/apehuci/manifest.json" rel=manifest><meta name=theme-color content="#b71c1c"><meta name=og:title content="[Middleman][kramdown][Rouge]Middleman v4でシンタックスハイライトMiddleman v4でシンタックスハイライト"><meta name=twitter:description content="Middlemanでシンタックスハイライトするにはmiddleman-syntaxがある。でもこの日記はMiddleman v4で作っていて、middleman-syntaxは今日時点ではv4に対応していない。のでフォークして対応させようかなと思ったけど、ふと思い出した。kramdownがそもそもシンタックスハイライトに対応しているはずだ。 kramdownは..."><meta name=twitter:card content=summary><meta name=twitter:site content=@KitaitiMakoto><meta name=twitter:image content="https://kitaitimakoto.github.io/apehuci/images/icon-bbe8ac52.png"></head><body class="x2015 x2015_11 x2015_11_07"><blog-router base-regex="^/apehuci/"></blog-router><main><app-header-layout><app-header fixed shadow slot=header><app-toolbar><h2 class=site-title><a href="../../"> アペフチ <paper-ripple></paper-ripple></a></h2></app-toolbar></app-header><article><header><paper-card><h1>Middleman v4でシンタックスハイライト</h1><time pubdate>2015-11-07</time><ul class=tags><li><a href="../../tags/middleman.html" rel=tag>Middleman</a></li><li><a href="../../tags/kramdown.html" rel=tag>kramdown</a></li><li><a href="../../tags/rouge.html" rel=tag>Rouge</a></li></ul></paper-card></header><paper-card><p><a href="https://middlemanapp.com/jp/">Middleman</a>でシンタックスハイライトするには<a href="https://github.com/middleman/middleman-syntax">middleman-syntax</a>がある。でもこの日記はMiddleman v4で作っていて、middleman-syntaxは今日時点ではv4に対応していない。のでフォークして対応させようかなと思ったけど、ふと思い出した。<a href="http://kramdown.gettalong.org/">kramdown</a>がそもそもシンタックスハイライトに対応しているはずだ。</p><p>kramdownはRuby製のMarkdownパーサー＋αのライブラリーで、MiddlemanでMarkdownを使う時のデフォルトエンジンにもなっている。MiddlemanでのMarkdownエンジンの設定方法、調整方法は公式ドキュメントにある（<a href="https://middlemanapp.com/jp/basics/template_engine_options/">テンプレートエンジンオプション</a>）。<code class=highlighter-rouge>markdown_engine</code>設定はデフォルトのままで構わないので、<code class=highlighter-rouge>markdown</code>設定だけ、config.rbにこう追加した。</p><div class="language-ruby highlighter-rouge"><pre class=highlight><code><span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="s1">'syntax_highlighter'</span> <span class="o">=&gt;</span> <span class="s1">'rouge'</span>
</code></pre></div><p>これで、Markdownの記事でのコード部分にシンタックスハイライト用の<code class=highlighter-rouge>&lt;span&gt;</code>が追加される。ここでは<code class=highlighter-rouge>rouge</code>を指定しているけど<code class=highlighter-rouge>coderay</code>も使える（gemは自分でGemfileに書いてインストールする必要がある）。この設定ではブロックレベルのコードだけでなく、文中の<code class=highlighter-rouge>span</code>要素もハイライトされる。この日記ではそのままにしているけど、嫌な場合には</p><div class="language-ruby highlighter-rouge"><pre class=highlight><code><span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="s1">'syntax_highlighter'</span> <span class="o">=&gt;</span> <span class="s1">'rouge'</span><span class="p">,</span>
    <span class="s1">'syntax_highlighter_opts'</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="s1">'span'</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s1">'disable'</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div><p>と、<code class=highlighter-rouge>span</code>の時だけ無効化してやればいい。その他、使えるオプションはkramdownサイトの<a href="http://kramdown.gettalong.org/syntax_highlighter/rouge.html">Syntax Highlighting With Rouge</a>というドキュメントにあるので参照されたい（Coderayの場合は<a href="http://kramdown.gettalong.org/syntax_highlighter/coderay.html">Syntax Highlighting With Coderay</a>）。</p><p>これだけでは単に<code class=highlighter-rouge>&lt;span&gt;</code>が追加されるだけでスタリングはされない。CSSを追加する必要がある。Rougeで使えるテーマは<a href="https://github.com/jneen/rouge/tree/master/lib/rouge/themes">Rougeのthemesディレクトリー</a>を見ればよくて、この日記ではGitHubテーマを使っている。stylesheets/highlight.css.erbというファイルを作って、こう書いた：</p><div class="language-erb highlighter-rouge"><pre class=highlight><code><span class="cp">&lt;%=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Themes</span><span class="o">::</span><span class="no">Github</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">scope: </span><span class="s1">'.highlighter-rouge'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre></div><p>この設定には<a href="http://3100.github.io/">Room 3100</a>というブログの<a href="http://3100.github.io/blog/2013/10/31/monokai-theme-to-middleman-blog.html">middleman-blogのハイライトにMonokaiテーマを使う</a>という記事を大いに参考にさせてもらった。ありがとうございます。</p><p>あとは「`…`」（インライン）やフェンストコードブロックでマークアップしてやればよい。注意が必要なのは、kramdownのコードブロックはGitHubのフェンストコードブロックとちょっと違って、「<code class=highlighter-rouge>~</code>」（チルダ）を三つ並べる（<a href="http://kramdown.gettalong.org/syntax.html#language-of-code-blocks">Language of Code Blocks</a>）。</p><div class=highlighter-rouge><pre class=highlight><code>~~~ ruby
set :markdown, 'syntax_highlighter' =&gt; 'rouge'
~~~
</code></pre></div></paper-card><footer><ul><li class=next><a href="20.html" rel=next><paper-button raised>日本語文書の全文検索</paper-button></a></li><li class=prev><a href="06.html" rel=prev><paper-button raised>全文検索の精度とスコアについて</paper-button></a></li></ul><paper-card><blog-search url="https://search.apehuci.kitaitimakoto.net/d" base=/apehuci/ table=Apehuci debounce-duration=300></blog-search></paper-card><paper-card> &copy; <a class=copy href="https://twitter.com/KitaitiMakoto">北市真</a></paper-card></footer></article></app-header-layout></main><script defer async src="//hypothes.is/embed.js"></script><script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script></body></html>