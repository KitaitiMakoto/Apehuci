<!DOCTYPE html><html><head><meta content="IE=edge" http-equiv=X-UA-Compatible><meta charset=utf-8><meta name=description content="北市真の日記"><meta content="width=device-width,initial-scale=1.0" name=viewport><title>アペフチ</title><script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script><link href="components/elements.vulcanized.html" rel=import /><link rel=alternate type="application/atom+xml" title="アペフチ" href="recent-days.atom"/><link href="bower_components/sanitize-css/sanitize.css" rel=stylesheet /><link href="stylesheets/highlight-81ca03d6.css" rel=stylesheet /><script src="javascripts/all-d7c52391.js"></script><link href="favicon.ico" rel="shortcut icon" type="image/x-icon"/><link href="images/favicon-8d71db77.png" rel=icon type="image/png" size=60x60 /><link href="/apehuci/manifest.json" rel=manifest><meta name=theme-color content="#b71c1c"><meta name=og:description content="北市真の日記"><meta name=og:title content="アペフチ"><meta name=twitter:card content=summary><meta name=twitter:site content=@KitaitiMakoto><meta name=twitter:image content="https://kitaitimakoto.github.io/apehuci/images/icon-bbe8ac52.png"><meta name=robots content="noindex,follow"></head><body class=index><blog-router base-regex="^/apehuci/"></blog-router><main><app-header-layout><app-header fixed condenses effects=waterfall slot=header><app-toolbar></app-toolbar><app-toolbar sticky><h1 class=site-title><a href="./">アペフチ</a></h1></app-toolbar></app-header><article><paper-card elevation=2><a href="2017/03/13.html"><h1>Hypothes.isがEPUBへのアノテーションのためのパートナーシップを結ぶ</h1><time pubdate>2017-03-13</time></a><ul class=tags><li><a href="tags/.html" rel=tag>電子書籍</a></li><li><a href="tags/.html" rel=tag>アノテーション</a></li><li><a href="tags/epub.html" rel=tag>EPUB</a></li><li><a href="tags/hypothes-is.html" rel=tag>Hypothes.is</a></li></ul><p><a href="https://note.mu/">note</a>や<a href="https://cakes.mu/">cakes</a>をやってる<a href="https://www.pieceofcake.co.jp/">ピースオブケイク</a>さんと勤め先の<a href="https://corkagency.com/">コルク</a>とで、毎週月曜ジャンプの発売日（僕の住んでいた札幌では火曜発売だったけどね）に<a href="https://note.mu/hashtag/%E3%83%86%E3%83%83%E3%82%AF%E4%BC%9A%E8%AD%B0?f=new&amp;search=on">#テック会議</a>と称してみんなでテック記事を上げるようにしましょうってなって、面白そうだし<a href="https://note.mu/">note</a>でなくて自分の日記でもいいってことだったので参加してみます。<a href="https://note.mu/hashtag/%E3%83%86%E3%83%83%E3%82%AF%E4%BC%9A%E8%AD%B0?f=new&amp;search=on">これまでの記事</a>を見てみると抽象的な話が多いようで、普段書いてる「これやってみた」という記事とは違うけど頑張ります。</p><p>別に参加者を絞るつもりはないようなので、皆さんも興味があれば更新日を月曜にずらしてみてください。<a href="https://note.mu/">note</a>を使う場合は<a href="https://note.mu/hashtag/%E3%83%86%E3%83%83%E3%82%AF%E4%BC%9A%E8%AD%B0?f=new&amp;search=on">#テック会議</a>でタグ付けしておくと探しやすくてありがたいです。特に報酬とかはありません。</p><p>さて長い前置きだったけど今日は、この前<a href="https://hypothes.is/">Hypothes.is</a>が出してきた、とても興奮するニュースの話をします。</p><p><a href="https://hypothes.is/blog/ebook-partnership/">A partnership to bring open annotation to eBooks</a><br/> （電子書籍にオープンなアノテーションをもたらすパートナーシップ）</p><p>一行で言うと、「ウェブページやPDFへのアノテーション用のウェブアプリケーション開発及びそのホスティングサービス運用を行ってきたHypothes.isが、EPUBにアノテーションを付けられるようにするべく、複数の組織とパートナーシップを結ぶ」というニュースです。これで伝わる人は殆どいないと思うので解説します。</p><h2 id=heading-2017-03-13-table-of-contents>目次</h2><ol><li><a href="#heading-2017-03-13-whats-annotation">アノテーションとは</a></li><li><a href="#heading-2017-03-13-whats-hypothesis">アノテーションサービスのHypothes.is</a></li><li><a href="#heading-2017-03-13-epub-ebook-format">電子書籍フォーマットのEPUB</a></li><li><a href="#heading-2017-03-13-hypothesis-partnership">Hypothes.isのパートナーシップ</a></li></ol><h2 id=heading-2017-03-13-whats-annotation>アノテーションとは</h2><p>アノテーションというのは日本語だと「注釈」です。例えばウェブページで、ある文章に線を引っ張って自分のメモ書きを残すことはアノテーションです。</p><p>「注釈」という言葉からは外れると感じますが、単に線を引っ張るだけでも、ここではアノテーションと呼びます。</p><figure><a href="https://gyazo.com/1ff7a03324fdc08da7f2f86c245431db"><img src="https://gyazo.com/1ff7a03324fdc08da7f2f86c245431db.png" alt=""/></a><figcaption>先のニュースページでハイライトされている様子。ハイライトされた部分の背景が黄色になっている。</figcaption></figure><p>また、ページの一部でなく、ページ全体に対して何か言及することもアノテーションです。<a href="http://b.hatena.ne.jp/">はてなブックマーク</a>なんかがいい例だと思います。</p><figure><a href="https://gyazo.com/47eb628941ce4e66cbc7928bb254753c"><img src="https://gyazo.com/47eb628941ce4e66cbc7928bb254753c.png" alt=""/></a><figcaption>ページ全体に対するコメントを残すのもアノテーション。画像ははてなブックマークの例。</figcaption></figure><p>先と同じパターンで、コメントのないブックマークも、アノテーションです。</p><h2 id=heading-2017-03-13-whats-hypothesis>アノテーションサービスのHypothes.is</h2><p><a href="https://hypothes.is/">Hypothes.is</a>は、こういうアノテーションを、ウェブページとPDFに付けられるようにするウェブアプリケーションです。ページをハイライトしたりコメントを入力したりするためのChrome拡張やJavaScriptウィジェットを作ったり、そのアノテーションを保存・参照するためのサーバー用のアプリケーションを開発しています。</p><p>と同時に、そのアプリケーションを実際に運用して、無償で提供してもいます。この日記にもJavaScriptウィジェットを埋め込んでいて、記事を（一覧ページでなく）個別ページで読んでいる場合には右側にそのためのバーが見えているはずです。</p><figure><a href="https://gyazo.com/777f1accfa73f2787a6b4c1bb0e0cd72"><img src="https://gyazo.com/777f1accfa73f2787a6b4c1bb0e0cd72.png" alt=""/></a><figcaption>アノテーションサービスHypothes.isのためのウィジェットを、無償で自分のウェブサイトにも埋め込める。</figcaption></figure><p>サイトの運用者はこのウィジェットを埋め込むことで、ページ全体または一部に閲覧者がハイライトやコメントを残せるようにできます。サイト側が対応していなくても、Chrome拡張を入れることで閲覧者はどのページにもアノテーションを付けられるようになります。付けられたアノテーションは（許可すれば）誰でも見ることができます。</p><p>こうして付けたアノテーションはHypothes.isのサーバーに保管され、どの端末、どのブラウザーでも見られるようになります（ブラウザー拡張は今のところChromeだけですが。Firefoxのは開発中で、自分でビルドして入れることはできます）。</p><h2 id=heading-2017-03-13-epub-ebook-format>電子書籍フォーマットのEPUB</h2><p>電子書籍では、こうした「アノテーションを付けて、それをどの端末でも参照できる」という体験を既に経験していると思います。Kindleのことです。</p><figure><a href="https://gyazo.com/f29495ff624f3e64f395cb21f9247848"><img src="https://gyazo.com/f29495ff624f3e64f395cb21f9247848.png" alt=""/></a><figcaption>Kindleでは電子書籍にハイライトやコメント、即ちアノテーションを付けることができる。</figcaption></figure><p>ところで、EPUBという電子書籍フォーマットがあります。IDPFという団体が策定した<strong>オープン</strong>なフォーマットです（KindleのはKindle Formatとかmobiとか呼ばれて、Kindleを作っているAmazon社が仕様を決めて運用しています。つまりオープンではありません）。仕様は誰でも見ることができますし、従って誰でも閲覧や作成用のアプリケーションを作れます。iBooksなどで読むことができます。</p><p>ちなみにPDFやWordファイル（*.docx）、Excelファイル（*.xlsx）、MP3なんかもオープンなファイルフォーマットです。Photoshop用ファイル（*.psd）やInDesign用ファイル（*.indd）はオープンではありません。</p><h2 id=heading-2017-03-13-hypothesis-partnership>Hypothes.isのパートナーシップ</h2><p>今回のニュースは、Hypothes.isがこのEPUBにも対応するべく、幾つかの組織とパートナーシップを結ぶ、という物です。Hypothes.isとのパートナーシップが発表された組織は以下の五つ。</p><dl><dt><a href="http://dlib.nyu.edu/dlts/">NYU Libraries</a></dt><dd>ニューヨーク大学の、デジタルな物を処理し、アクセスを可能にし、また保管する所。</dd><dt><a href="https://nyupress.org/">NYU Press</a></dt><dd>ニューヨーク大学の出版社？</dd><dt><a href="http://www.evidentpoint.com/">Evident Point</a></dt><dd>電子出版ソリューションを提供する提供する会社。Readium（下記参照）のコアコントリビューターを数人抱えているらしい。</dd><dt><a href="http://readium.org/">Readium Foundation</a></dt><dd>ReadiumJSという、EPUBを扱うJavaScriptのリファレンス実装を作っている所。ReadiumJSはDRMも扱えるとのこと。</dd><dt><a href="http://futurepress.org/">EPUBjs project</a></dt><dd>epub.jsという、Readiumとはまた別のJavaScript実装を作っているプロジェクト。既にHypothes.isと連携したプルーフオブコンセプトを作った実績がある。</dd></dl><p>イデオロギー的に僕はオープンな物やフリーな物を支持しているので、オープンなファイルフォーマットにオープンなアプリケーションでアノテーションが付けられるというこのニュースにはとても興奮しました。</p><p>いきなりイデオロギーの話が出てきて面喰らうかも知れませんが、フリーとかオープンとかは殆どイデオロギーの話だと思っています<sup id="fnref:free-open-as-ideology"><a href="#fn:free-open-as-ideology" class=footnote>1</a></sup>。</p><p>ま、イデオロギーは置いておいても、オープンであればロックインされない（Kindleだと、Kindleがなくなると同時に自分の本のコメントが失われてしまう）、とか無料だとかメリットがあります。例えばiBooksで付けたブックマークをGoogle Play Booksで開くといったこともできるかも知れません（Appleがブックマークデータをダウンロードさせてくれれば）。</p><p>というような感じでいいのか知ら？　皆さんも、<a href="https://note.mu/hashtag/%E3%83%86%E3%83%83%E3%82%AF%E4%BC%9A%E8%AD%B0?f=new&amp;search=on">#テック会議</a>ぜひ参加してみてください。</p><div class=footnotes><ol><li id="fn:free-open-as-ideology"><p>川上量生『<a href="https://www.iwanami.co.jp/book/b226338.html">鈴木さんにも分かるネットの未来</a>』でそんな感じのことが書かれていてはっとしました。&nbsp;<a href="#fnref:free-open-as-ideology" class=reversefootnote>&#8617;</a></p></li></ol></div></paper-card></article><article><paper-card elevation=2><a href="2017/01/10.html"><h1>Polymerでpjaxする、またはapp-locationの使い方</h1><time pubdate>2017-01-10</time></a><ul class=tags><li><a href="tags/polymer.html" rel=tag>Polymer</a></li><li><a href="tags/pjax.html" rel=tag>pjax</a></li></ul><p>この日記は<a href="https://www.polymer-project.org/1.0/">Polymer</a>で作っている、つまり<a href="http://webcomponents.org/">Webコンポーネント</a>を使っている。そのために表示が遅い。表示するまでに</p><ol><li>Webコンポーネントに必要なpolyfillを読み込む</li><li>Polymerライブラリーを読み込む</li><li>各種カスタムエレメント定義をロードする</li><li>JavaScriptで各種カスタムエレメント定義を実行する</li><li>HTML中の各種カスタムエレメントを有効化する</li></ol><p>というステップがあって、これを毎ページ繰り返すからだ。前々から何とかしたいなあとは思っていて、この連休で、サイト内リンクをpjaxにすることで少し改善させた。</p><p>各ステップはpjaxによって以下のように改善される。</p><h2 id=heading-2017-01-10-table-of-contents>目次</h2><ol><li><a href="#heading-2017-01-10-whats-pjax">pjaxとは</a></li><li><a href="#heading-2017-01-10-loading-polyfill">polyfill読み込み</a></li><li><a href="#heading-2017-01-10-loading-polymer">Polymerライブラリーの読み込み</a></li><li><a href="#heading-2017-01-10-loading-custom-elements">カスタムエレメント読み込み</a></li><li><a href="#heading-2017-01-10-defining-custom-elements">カスタムエレメント定義の実行</a></li><li><a href="#heading-2017-01-10-pjax-using-polymer">Polymerでpjax</a><ol><li><a href="#heading-2017-01-10-app-location">app-location</a></li><li><a href="#heading-2017-01-10-iron-ajax">iron-ajax</a></li></ol></li><li><a href="#heading-2017-01-10-afterwords">終わりに</a></li></ol><h2 id=heading-2017-01-10-whats-pjax>pjaxとは</h2><p>有名なので不要だとは思うけど、一応pjaxを説明しておく。</p><p>pjaxは、</p><ul><li>Ajaxによる画面遷移</li><li><code class=highlighter-rouge>location</code>オブジェクト（アドレスバーのURL）の書き換え</li></ul><p>の組み合わせだ。サイト内の別ページへのリンクをタップした際に、通常のブラウザーの画面遷移をする代わりに、JavaScriptでリンク先のHTMLを取得して、現在のページと置き換える。今回は、<code class=highlighter-rouge>title</code>要素と<code class=highlighter-rouge>main</code>要素を置き換えることで、画面遷移としている。ページ全体でなく、一部の書き換え・更新にもよく使われる。</p><p>同時に<code class=highlighter-rouge>location</code>を書き換えることで、ブラウザーの進む/戻る・リロード、アドレスバーからURLをコピーしての共有など、通常の画面遷移であればできていることを可能にしている。</p><p>後者のためにJavaScriptの<code class=highlighter-rouge>pushState</code>機能を使っていることからpjaxと名付けられている：<br/><a href="https://github.com/defunkt/jquery-pjax">defunkt/jquery-pjax: pushState + ajax = pjax</a></p><p>pjaxは「現在のDOMツリー内での置き換え」が機能なので、外から飛んできて最初に表示するページでは役に立たない。</p><h2 id=heading-2017-01-10-loading-polyfill>polyfill読み込み</h2><p>Webコンポーネントはまだ策定中・ブラウザー実装途中の仕様なので、クロスブラウザーでは動かない。具体的には、Chromeでしか全部は動かない。そこで、他のブラウザーでも動くよう、polyfillやshimを読み込む必要がある。</p><p>これにはWebコンポーネント仕様の一部であるカスタムエレメントなど以外にも、URLコンストラクターやPromiseなどのpolyfillも含まれる。サーバー側でブラウザーの判定などはしていないので（GitHub Pagesなのでそもそもできない）、Chromeのように不要であっても読み込んでいる。</p><p>こういうのは普通、<code class=highlighter-rouge>libs.js</code>のような一つのファイルにまとめることでリクエスト回数を減らすものだけど、面倒くさくて後回しにしている（後回しにするうちにGitHub PagesでHTTP/2が使えるようになるといいなあ、という期待もちょっとある）。</p><p>pjaxによって、<code class=highlighter-rouge>main</code>の外にある<code class=highlighter-rouge>script</code>の読み込みと実行がスキップされるので、パフォーマンスがよくなっている。あと、そもそも同じ<code class=highlighter-rouge>script</code>を二回読み込んだりすると、イベントリスナーの登録が複数回行われたりして意図しない動作になりがちなので、基本的に<code class=highlighter-rouge>script</code>はpjaxでの置き換え対象に入れたくない。</p><h2 id=heading-2017-01-10-loading-polymer>Polymerライブラリーの読み込み</h2><p>ページをPolymerで作っている以上、当然Polymerを読み込む必要がある。</p><p>これもJavaScriptの読み込みなので、上と同じくpjaxによってスキップし、パフォーマンスを向上させている。</p><h2 id=heading-2017-01-10-loading-custom-elements>カスタムエレメント読み込み</h2><p>Polymerが提供していてマテリアルデザインを実現するのに便利な<a href="https://elements.polymer-project.org/browse?package=paper-elements">Paper Elements</a>や自作の物など、各種カスタムエレメントは通常一つのHTMLファイルになっている。その中に、HTMLタグの他CSS宣言や要素定義のJavaScriptを書くようになっているし、僕もそうしている。一つのカスタムエレメントが複数のカスタムエレメントの組み合わせであることもよくあって、依存エレメントの分HTMLを読み込む必要があるのが普通だ。</p><p>先のJavaScriptライブラリーとは違って、これはさすがにリクエストが多くなり過ぎるので<a href="https://github.com/Polymer/vulcanize">vulcanize</a>によって一つのファイルにまとめている。その一つにまとめたHTMLファイルは<code class=highlighter-rouge>head</code>要素中の<code class=highlighter-rouge>link</code>要素</p><div class="language-html highlighter-rouge"><pre class=highlight><code><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"components/elements.vulcanized.html"</span> <span class="na">rel=</span><span class="s">"import"</span> <span class="nt">/&gt;</span>
</code></pre></div><p>によって読み込んでいる（実際にはこのタグを書き出すヘルパーが<a href="https://github.com/KitaitiMakoto/middleman-web_components">Middleman Web Components</a>にあるので、それを使っている）。</p><p>これも<code class=highlighter-rouge>main</code>要素の外にあるので、pjaxによってスキップしている。</p><h2 id=heading-2017-01-10-defining-custom-elements>カスタムエレメント定義の実行</h2><p>カスタムエレメントは、単にHTML中に<code class=highlighter-rouge>&lt;paper-card&gt;</code>などタグを書くだけでは有効にならない（知らないタグとして扱われる）。このタグがカスタムエレメントの物であることをブラウザーに知らせ、各種機能を定義するにはJavaScriptを使う必要がある（参考：<a href="https://developers.google.com/web/fundamentals/getting-started/primers/customelements">Custom Elements v1: Reusable Web Components</a>）。</p><p>この定義は、上の<code class=highlighter-rouge>elements.vulcanized.html</code>に書かれているので、pjaxによってやはりこのステップもスキップできる。</p><p>これまでのステップは、（HTTPヘッダーやService Workerなどで）キャッシュを上手に使うことでも飛ばせるのだけど、カスタムエレメント定義は、ファイルを読み込んだ<strong>後</strong>の処理なので、ページ遷移ごとに毎回実行する必要があり、キャッシュできない。なのでここが、キャッシュ機構を入れてもなおpjaxが活きるところだと思う。</p><p>本当はpolyfillやPolymer読み込みをキャッシュしても、同様にJavaScript実行はページ表示毎に発生するのだけど、カスタムエレメント定義は特に多くなりがちなので特別に節を設けた。</p><h2 id=heading-2017-01-10-activating-custom-elements>カスタムエレメントの有効化</h2><p>カスタムエレメント定義が終わったらブラウザーは、HTML中のカスタムエレメントタグ（に相当するDOMノード）を、そのカスタムエレメントとして扱い始める。このステップはpjaxではスキップできない。</p><h2 id=heading-2017-01-10-pjax-using-polymer>Polymerでpjax</h2><p>ようやく本題だけど、今回のpjax実装では、Polymerが提供している<a href="https://elements.polymer-project.org/elements/app-route?active=app-location">app-location</a>と<a href="https://elements.polymer-project.org/elements/iron-ajax">iron-ajax</a>というカスタムエレメントを使って実現してみた（<a href="https://github.com/KitaitiMakoto/apehuci/blob/26e1f03ac1a28983faa094b32b98ed1ad4822c26/source/components/blog-router.html">blog-router.html</a>）。pjaxは普通、全部JavaScriptでやるものだと思うけど、半分くらいの処理はHTMLタグを書くことで実現できてしまっていて、不思議な感じがした。</p><h3 id=heading-2017-01-10-app-location>app-location</h3><p><code class=highlighter-rouge>app-location</code>を使うと、サイト内リンクが全部無効化される。その代わり、イベントリスナーでクリックイベントをハンドリングしたり、リンクに関する情報をデータバインディングを使って別の要素に渡したりできる。</p><p>今回は</p><div class="language-html highlighter-rouge"><pre class=highlight><code><span class="nt">&lt;app-location</span> <span class="na">url-space-regex</span><span class="err">$="[[</span><span class="na">baseRegex</span><span class="err">]]"</span> <span class="na">route=</span><span class="s">"{{route}}"</span> <span class="na">id=</span><span class="s">location</span><span class="nt">&gt;&lt;/app-location&gt;</span>
</code></pre></div><p>と<code class=highlighter-rouge>route</code>というオブジェクトに、画面遷移に関する情報を入れることにした。</p><p><code class=highlighter-rouge><span class=p>{</span><span class=err>{...</span><span class=p>}</span><span class=err>}</span></code>はPolymerの提供するデータバインディング用の記法で、他に<code class=highlighter-rouge><span class=p>{</span><span class=err>{route</span><span class=p>}</span><span class=err>}</span></code>と書かれた場所と連動する（<a href="https://www.polymer-project.org/1.0/docs/devguide/data-binding">Data binding - Polymer Project</a>）。</p><h3 id=heading-2017-01-10-iron-ajax>iron-ajax</h3><p><code class=highlighter-rouge>app-location</code>は、アドレスバーのURLの書き換えはしてくれるけど、実際のリクエストは投げてくれない。ので、それをJavaScriptでイベントハンドラーとして書くか、今回のように別の要素と連携させないと意味がない。</p><p><code class=highlighter-rouge>iron-ajax</code>はその名の通りAjaxしてくれるカスタムエレメントで、画面上にレンダリングはされない。純粋にJavaScript的な実行のためにある。これが要素になっているが不思議な感じがする。</p><p>これもデータバインディングの記法を使いつつ</p><div class="language-html highlighter-rouge"><pre class=highlight><code><span class="nt">&lt;iron-ajax</span> <span class="na">url=</span><span class="s">"{{route.path}}"</span> <span class="na">handle-as=</span><span class="s">document</span> <span class="na">auto</span> <span class="na">on-response=</span><span class="s">transit</span> <span class="na">on-error=</span><span class="s">fallback</span> <span class="na">id=</span><span class="s">ajax</span><span class="nt">&gt;&lt;/iron-ajax&gt;</span>
</code></pre></div><p>と書くことで、<code class=highlighter-rouge>app-location</code>の<code class=highlighter-rouge>route</code>オブジェクトから<code class=highlighter-rouge>path</code>プロパティを取り出してセットしている（<code class=highlighter-rouge>path</code>の他に<code class=highlighter-rouge>hash</code>プロパティもあって、本当はこれもちゃんとハンドリングしないといけない）。</p><p><code class=highlighter-rouge>auto</code>属性をつけていると<code class=highlighter-rouge>url</code>属性が変わった際に自動でAjaxが行われるので、</p><div class=highlighter-rouge><pre class=highlight><code>リンクをタップ -&gt; app-locationのroute属性変更 -&gt; iron-ajaxのurl変更 -&gt; Ajaxリクエスト
</code></pre></div><p>という流れをJavaScriptを書かずに実現してくれる（リクエストを間引くのも、使ってないけど、HTML属性によって定義できる）。</p><p>あとはレスポンス時やエラー時の処理をそれぞれ<code class=highlighter-rouge>transit</code>、<code class=highlighter-rouge>fallback</code>という関数としてJavaScriptで書いてやって出来上がりだ。<code class=highlighter-rouge>transit</code>としてJavaScriptで書いた処理は、殆ど<code class=highlighter-rouge>title</code>要素と<code class=highlighter-rouge>main</code>要素の書き換えのみ。</p><h2 id=heading-2017-01-10-afterwords>終わりに</h2><p>Polymerによるpjaxはこのようにして実現できる。これには、公式サイトの以下のページがとても参考になった。</p><p>» <a href="https://www.polymer-project.org/1.0/toolbox/routing">Routing with &lt;app-route&gt; - Polymer Project</a></p><p>余談だけど、<a href="https://github.com/turbolinks/turbolinks">Turbolinks</a>を使うと自分で実装しなくてよかったのかも知れないなと思っている。</p><p>あと、今回、ページ内に一つ<code class=highlighter-rouge>blog-router</code>を置くことによって、つまり一元的なルーターを使ってpjaxを実現している。ReactやAngularでもルーターライブラリーがあるように、この手の処理は一元的なルーターでやるのが普通なのかも知れない。でも、次へリンクなどのHTML要素に結び付く形で、それがpjaxによる遷移かどうかを管理できるようにする、引いては、そのリンクのカスタムエレメントの機能としてpjax処理を実装できた方が、コンポーネント志向としてはいいのかも知れないなあと、やった後で思った。気が向いたらやってみるかも（そして、世界中のみんながルーターを一元的に作っている理由を知るのだ、きっと）。</p><p>今この記事書いてて気付いたけど、ページ内リンクが機能しなくなってしまった……。もう遅いので、後日の対応とします。（追記。直しました。）</p></paper-card></article><article><paper-card elevation=2><a href="2017/01/08.html"><h1>リポジトリーをGitHubからGitLabに移してみた</h1><time pubdate>2017-01-08</time></a><ul class=tags><li><a href="tags/gitlab.html" rel=tag>GitLab</a></li></ul><p><a href="http://www.rubydoc.info/gems/epub-parser/file/docs/Home.markdown">EPUB Parser</a> gemのリポジトリーを、<a href="https://github.com/">GitHub</a>から<a href="https://gitlab.com/">GitLab</a>に移してみた：<br/><a href="https://gitlab.com/KitaitiMakoto/epub-parser">https://gitlab.com/KitaitiMakoto/epub-parser</a></p><p>ここのところフリーとかオープンソースソフトウェアとサービスとかについて感じるところの記事を書いていて（未公開）、その過程でGitLabのことを思い出したので、やってみたのだった。</p><p>前にクローンはしていたのだけど、<code class=highlighter-rouge>master</code>ブランチへのフォースプッシュが禁止されていたので、使わなくなっていた。でも今見てみたら、設定によりそれが可能になっていたので、改めて移行した。</p><blockquote class=twitter-tweet data-lang=ja><p lang=ja dir=ltr>GitLabがmasterブランチにもフォースプッシュ可能になってた。<br/>右上歯車→Protected Branches→画面下ブランチの「Unprotect」</p>&mdash; 北市真 (@KitaitiMakoto) <a href="https://twitter.com/KitaitiMakoto/status/816234964412809216">2017年1月3日</a></blockquote><script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script><p>GitHubは<a href="https://travis-ci.org/">Travis CI</a>や<a href="https://circleci.com/">CircleCI</a>なんかとのインテグレーションが便利だけど、GitLab.comは自前でCI機能を備えていて、YAMLファイル（<code class=highlighter-rouge>.gitlab-ci.yml</code>）をリポジトリーに入れておくと、その他の設定なしで自動でテストを走らせてくれる。べんり。</p><div class="language-yaml highlighter-rouge"><pre class=highlight><code><span class="s">before_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">apt-get update -qq &amp;&amp; apt-get install -y zip</span>
  <span class="pi">-</span> <span class="s">ruby -v</span>
  <span class="pi">-</span> <span class="s">which ruby</span>
  <span class="pi">-</span> <span class="s">gem install bundler --no-document</span>
  <span class="pi">-</span> <span class="s">bundle install --jobs=$(nproc) "${FLAGS[@]}"</span>

<span class="s">test:2.2</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">ruby:2.2</span>
  <span class="s">script</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">bundle exec rake test</span>

<span class="s">test:2.3</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">ruby:2.3</span>
  <span class="s">script</span><span class="pi">:</span> <span class="s">bundle exec rake test</span>

<span class="s">test:2.4</span><span class="pi">:</span>
  <span class="s">image</span><span class="pi">:</span> <span class="s">ruby:2.4</span>
  <span class="s">script</span><span class="pi">:</span> <span class="s">bundle exec rake test</span>
</code></pre></div><h2 id=heading-2017-01-08-whats-gitlab>GitLabとは</h2><p><a href="https://gitlab.com/">GitLab</a>は、Gitを使ったプロジェクトのホスティングウェブアプリケーションで、ざっくり言ってGitHubクローンだ。基本的な部分（<a href="https://gitlab.com/gitlab-org/gitlab-ce">Community Edition</a>）のソースコードは公開されていて、自前のサーバーにインストールして使うことができる。Enterprise Editionが有償になっている。その他にホスティングサービス（GitLab.com）もやっていて、これを今回は使った。</p><p>Gitリポジトリーのホスティングの他、READMEの表示、スター、フォーク、マージリクエスト（プルリクエスト）、イシュー登録、コミット履歴表示、コミット毎の差分表示、ウィキ、グループによるメンバー管理、（GitHub Pagesのような）静的ウェブサイトのホスティング、（Gistのような）スニペットなどなど、GitHubの基本的な機能は備えている（使い勝手や速度で及ばないところはある）。</p><p>ちょっとググった感じだと自前サーバーでGitのプロジェクトをホストするために使われる例が多いようだけど、GitHub.comの代替として使ってもいいと思う。僕は、アプリケーションのソースコードが公開されているということで、使い始めてみた。前はGitoriousが担っていた立ち位置だと思う（事実、Gitoriousがシャットダウンする時に、GitLabを案内していた）。</p><p>この日記はGitHub Pagesのドメインで公開しているので、移行できない。</p><h2 id=heading-2017-01-08-reference>追記：GitLab参考記事</h2><p>奇しくも最近、1/5に、Gihyo.jpでGitLabの記事が上がっていた：<br/><a href="http://gihyo.jp/dev/column/newyear/2017/gitlab">GitLabのこれまでとこれから：新春特別企画｜gihyo.jp … 技術評論社</a></p></paper-card></article><footer><ul><li class=prev><a href="page/2/" rel=prev><paper-button raised>次3日分</paper-button></a></li></ul><paper-card><blog-search url="https://search.apehuci.kitaitimakoto.net/d" base=/apehuci/ table=Apehuci debounce-duration=300></blog-search></paper-card><paper-card> &copy; <a class=copy href="https://twitter.com/KitaitiMakoto">北市真</a></paper-card></footer></app-header-layout></main><script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script></body></html>